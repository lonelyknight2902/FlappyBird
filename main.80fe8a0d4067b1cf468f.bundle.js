(()=>{"use strict";const t=200,e=200,s=1e3;class i{constructor(t,e){this._canvas=document.createElement("canvas"),this._canvas.width=t,this._canvas.height=e,this._canvas.style.height="100vh";const s=document.getElementById("game");if(null===s)return void alert("Unable to find game element");s.appendChild(this.canvas);const i=document.createElement("img");i.src="assets/images/background-day.png";const r=document.createElement("img");r.src="assets/images/background-night.png",this._background={day:i,night:r},this._currentBackground="day",this._restart=!0}get canvas(){return this._canvas}set canvas(t){this._canvas=t}getContext(){return this.canvas.getContext("2d")}update(t){let e;this._restart?(this._start=Date.now(),e=0,this._restart=!1):e=(Date.now()-this._start)/2e4,e>=1&&(this._start=Date.now(),this._currentBackground="day"===this._currentBackground?"night":"day",e=0),this._currentAlpha=e*e/(2*(e*e-e)+1)}reset(){this._start=Date.now(),this._currentBackground="day",this._currentAlpha=0,this._restart=!0}renderBackground(){const t=this.canvas.getContext("2d");null!==t?(t.save(),t.globalAlpha=this._currentAlpha,t.drawImage(this._background["day"===this._currentBackground?"night":"day"],0,0,this.canvas.width,this.canvas.height),t.globalAlpha=1-this._currentAlpha,t.drawImage(this._background[this._currentBackground],0,0,this.canvas.width,this.canvas.height),t.restore()):alert("Unable to get 2d context")}set currentBackground(t){this._currentBackground=t}get currentBackground(){return this._currentBackground}clear(){const t=this.canvas.getContext("2d");null!==t&&t.clearRect(0,0,this.canvas.width,this.canvas.height)}static getInstance(t,e){return i.canvas||(i.canvas=new i(t,e)),i.canvas}}const r=i;class a{constructor(t){this._keys={},this._mouse={x:0,y:0},this._touch={x:0,y:0},this._mouseClick=!1,this._touchStart=!1,this._canvas=t,window.addEventListener("keydown",(t=>{t.preventDefault()," "===t.key?this._keys.Space=!0:this._keys[t.key]=!0})),window.addEventListener("touchstart",(t=>{t.preventDefault(),this._touchStart=!0;const e=this._canvas.getBoundingClientRect(),s=this._canvas.width/e.width,i=this._canvas.height/e.height;this._touch.x=(t.touches[0].clientX-e.left)*s,this._touch.y=(t.touches[0].clientY-e.top)*i})),window.addEventListener("touchend",(t=>{t.preventDefault(),this._touchStart=!1})),window.addEventListener("keyup",(t=>{t.preventDefault()," "===t.key?this._keys.Space=!1:this._keys[t.key]=!1})),window.addEventListener("mousemove",(t=>{const e=this._canvas.getBoundingClientRect(),s=this._canvas.width/e.width,i=this._canvas.height/e.height;this._mouse.x=(t.clientX-e.left)*s,this._mouse.y=(t.clientY-e.top)*i})),window.addEventListener("mousedown",(t=>{t.preventDefault(),this._mouseClick=!0})),window.addEventListener("mouseup",(t=>{t.preventDefault(),this._mouseClick=!1}))}isKeyDown(t){return this._keys[t]||!1}get mouse(){return this._mouse}isClicked(){return this._mouseClick}get touch(){return this._touch}isTouchStart(){return this._touchStart}static getInstance(t){return a.instance||(a.instance=new a(t)),a.instance}}const n=a;class o{constructor(t=0,e=0){this.x=t,this.y=e}normalize(){if(0===this.magnitude())return this;const t=this.x/this.magnitude(),e=this.y/this.magnitude();return new o(t,e)}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}distanceTo(t){const e=this.x-t.x,s=this.y-t.y;return Math.sqrt(e*e+s*s)}directionTo(t){return new o(t.x-this.x,t.y-this.y)}add(t){return new o(this.x+t.x,this.y+t.y)}multiply(t){return new o(this.x*t,this.y*t)}}o.zero=new o(0,0);const h=o,c=class{constructor(t,e,s,i){this.position=new h(t,e),this.rotation=s,this.scale=i}getPosition(){return this.position}setPosition(t,e){this.position.x=t,this.position.y=e}getRotation(){return this.rotation}setRotation(t){this.rotation=t}};class l{}class d extends l{constructor(t,e){super(),this._center=t,this._radius=e}checkCollision(t){return t.checkCollisionWithCircle(this)}checkCollisionWithCircle(t){return this._center.distanceTo(t._center)<this._radius+t._radius}checkCollisionWithBox(t){const e=t.getClosestPoint(this._center);return this._center.distanceTo(e)<this._radius}getClosestPoint(t){const e=this._center.directionTo(t);return this._center.add(e.normalize().multiply(this._radius))}get center(){return this._center}get radius(){return this._radius}setPosition(t,e){this._center=new h(t,e)}}class g extends l{constructor(t,e,s,i){super(),this.width=t,this.height=e,this.transform=new c(s,i,0,1)}getClosestPoint(t){const e=Math.max(0,Math.min(t.x,this.width)),s=Math.max(0,Math.min(t.y,this.height));return new h(e,s)}checkCollision(t){return t instanceof d?this.checkCollisionWithCircle(t):t instanceof g&&this.checkCollisionWithBox(t)}checkCollisionWithCircle(t){return this.getClosestPoint(t.center).distanceTo(t.center)<t.radius}checkCollisionWithBox(t){const e=this.transform.getPosition(),s=t.transform.getPosition();return e.x<s.x+t.width&&e.x+this.width>s.x&&e.y<s.y+t.height&&e.y+this.height>s.y}setPosition(t,e){this.transform.setPosition(t,e)}}const u=class{constructor(t=0,e=h.zero){this.speed=t,this.direction=e}getSpeed(){return this.speed}getDirection(){return this.direction}setSpeed(t){this.speed=t}setDirection(t){this.direction=t}};var _,p;!function(t){t.RIGID_BODY="RIGID_BODY",t.STATIC_BODY="STATIC_BODY"}(_||(_={})),function(t){t.ENTER="ENTER",t.EXIT="EXIT",t.STAY="STAY",t.OUT="OUT"}(p||(p={}));const m=class{constructor(t,e,s,i="GameObject"){this.parent=null,this.children=[],this.display=!0,this.transformAnimation=null,this.transform=new c(0,0,0,1),this.velocity=new u,this.width=t,this.height=e,this.collider=new g(t,e,this.transform.getPosition().x,this.transform.getPosition().y),this.bodyType=s,this._name=i}get name(){return this._name}set name(t){this._name=t}getWidth(){return this.width}getHeight(){return this.height}update(t){const e=this.transform.getPosition(),s=this.velocity.getDirection().normalize(),i=this.collider.transform.getPosition(),r=this.velocity.getSpeed();e.x+=s.x*r*t.delta/1e3,e.y+=s.y*r*t.delta/1e3;const a=this.getWorldPosition();i.x=a.x,i.y=a.y,this.children.forEach((e=>{e.update(t)})),this.transformAnimation&&this.transformAnimation.update(t)}triggerUpdate(t){return p.OUT}reset(){}updateGravity(t){this.bodyType===_.RIGID_BODY&&this.velocity.setSpeed(this.velocity.getSpeed()+2e3*t.delta/1e3)}handleCollision(t,e){const s=this.transform.getPosition(),i=(this.velocity.getSpeed(),this.velocity.getDirection().normalize(),this.collider.transform.getPosition()),r=e.transform.getPosition();(i.x>=r.x||i.x<=r.x+e.width)&&(s.x=r.x-1),(i.y>=r.y||i.y<=r.y+e.height)&&(s.y=r.y-1)}setPosition(t,e){this.transform.setPosition(t,e),this.collider.transform.setPosition(t,e)}getPosition(){return this.transform.getPosition()}getWorldPosition(){let t=this.transform.getPosition(),e=this.parent;for(;e;)t=t.add(e.getPosition()),e=e.parent;return t}setVelocity(t,e){this.velocity.setSpeed(t),this.velocity.setDirection(e)}setSpeed(t){this.velocity.setSpeed(t)}setDirection(t){this.velocity.setDirection(t)}render(t){this.display&&this.children.forEach((e=>{e.render(t)}))}setCollider(t,e,s,i){const r=this.getWorldPosition();this.collider=new g(t,e,r.x+s,r.y+i)}setRotation(t){this.transform.setRotation(t)}getTransform(){return this.transform}setParent(t){this.parent=t;const e=this.getWorldPosition();this.collider.setPosition(e.x,e.y)}addChild(t){this.children.push(t),t.setParent(this)}removeChild(t){this.children=this.children.filter((e=>e!==t))}},y=class{constructor(t){this._audio=t,this._audio.preload="auto"}play(){this._audio.currentTime=0,this._audio.play().catch((function(t){console.log("Audio play was prevented:",t)}))}stop(){this._audio.pause()}},f=class extends m{constructor(t,e,s,i){super(t,e,_.STATIC_BODY),console.log("TriggerObject constructor"),this._transform=new c(s,i,0,1),this._width=t,this._height=e,this._objectsInArea=[],this.setPosition(s,i)}set audio(t){this._audio=new y(t)}triggerUpdate(t){for(let e=0;e<t.length;e++){if(this.collider.checkCollision(t[e].collider)&&!this._objectsInArea.includes(t[e]))return this.onTriggerEnter(t[e]),p.ENTER;if(!this.collider.checkCollision(t[e].collider)&&this._objectsInArea.includes(t[e]))return this.onTriggerExit(t[e]),p.EXIT}return p.STAY}onTriggerEnter(t){console.log("TriggerObject onTriggerEnter"),this._objectsInArea.push(t)}onTriggerExit(t){console.log("TriggerObject onTriggerExit"),this._objectsInArea=this._objectsInArea.filter((e=>e!==t)),console.log("Play"),this._audio.play()}onTriggerStay(){console.log("TriggerObject onTriggerStay")}reset(){this._objectsInArea=[]}render(t){}},w=class extends m{constructor(t,e,s){super(t,e,s,"Base"),this.sprite=document.createElement("img"),this.spriteSource="assets/images/base.png",this.sprite.src=this.spriteSource,this.width=t,this.height=e}render(t){if(!this.display)return;const e=this.transform.getPosition();t.drawImage(this.sprite,e.x,e.y,this.width,this.height)}},x=class extends m{constructor(t,e,s,i){super(t,e,i,"Obstacle"),console.log("Obstacle created"),this.sprite=document.createElement("img"),this.spriteSource=s,this.sprite.src=this.spriteSource;const r=Math.floor(300*Math.random())+100;this.setPosition(170,r)}render(t){if(!this.display)return;const e=this.getWorldPosition();super.render(t),t.drawImage(this.sprite,e.x,e.y,104,640)}},b=class{render(t,e){const s=t.animation.currentFrame,i=t.getPosition();e.save(),e.translate(i.x+t.width/2,i.y+t.height/2);const r=t.getTransform().getRotation()*(Math.PI/180);e.rotate(r),e.translate(-i.x-t.width/2,-i.y-t.height/2),e.drawImage(s,i.x,i.y,68,48),e.restore()}enter(t){t.animation.play(!0)}exit(t){}},S=class{constructor(){this._currentFrame=0,this._frameDuration=0,this._frameTime=0,this._frames=[],this._currentFrame=0,this._frameDuration=0,this._frameTime=0,this._isPlaying=!1,this._isLooping=!1}get currentFrame(){return this._frames[this._currentFrame]}get isPlaying(){return this._isPlaying}get isLooping(){return this._isLooping}get frameDuration(){return this._frameDuration}set frameDuration(t){this._frameDuration=t}addFrame(t){this._frames.push(t)}play(t=!1){this._isPlaying=!0,this._isLooping=t}stop(){this._isPlaying=!1}update(t){this._isPlaying&&(this._frameTime+=t.delta,this._frameTime>=this._frameDuration&&(this._frameTime=0,this._currentFrame++,this._currentFrame>=this._frames.length&&(this._isLooping?this._currentFrame=0:(this._isPlaying=!1,this._currentFrame=this._frames.length-1))))}reset(){this._currentFrame=0,this._frameTime=0}};class v extends m{constructor(){super(68,48,_.RIGID_BODY,"Player"),this._flapped=!1,console.log("Player created"),this._sprite=[],this._spriteSource=["assets/images/yellowbird-midflap.png","assets/images/yellowbird-upflap.png","assets/images/yellowbird-downflap.png"],this._spriteSource.forEach((t=>{const e=document.createElement("img");e.src=t,this._sprite.push(e)})),this.animation=new S,this.animation.addFrame(this._sprite[0]),this.animation.addFrame(this._sprite[1]),this.animation.addFrame(this._sprite[0]),this.animation.addFrame(this._sprite[2]),this.animation.frameDuration=50,this._spriteCycle=[0,1,0,2],this._frameCount=0,this._currentFrame=0,this._rotationSpeed=0,this._rotationAcceleration=0,this._start=Date.now(),this._state=new b,this._state.enter(this)}static getInstance(){return v.player||(v.player=new v,console.log("Player created")),v.player}set flapAudio(t){this._flapAudio=new y(t)}update(t){super.update(t),this.animation.update(t);let e=this.transform.getRotation()+this._rotationSpeed*t.delta/1e3;e<-30?(e=-30,this._rotationSpeed=0):e>90?e=90:(e=this.transform.getRotation()+this._rotationSpeed*t.delta/1e3,this._rotationSpeed+=this._rotationAcceleration*t.delta/1e3),this.transform.setRotation(e)}set spriteSource(t){this.spriteSource=t}render(t){this.display&&this._state.render(this,t)}flap(){this._flapped||(this._flapped=!0,this.setSpeed(-500),this.setRotation(-30),this.setRotationSpeed(0),this._flapAudio.play())}unflap(){this._flapped=!1}setRotationSpeed(t){this._rotationSpeed=t}setRotationAcceleration(t){this._rotationAcceleration=t}get start(){return this._start}set start(t){this._start=t}get currentFrame(){return this._currentFrame}set currentFrame(t){this._currentFrame=t}get spriteCycle(){return this._spriteCycle}get sprite(){return this._sprite}set state(t){this._state=t}get state(){return this._state}}const T=v,P=class{constructor(){this._score=0,this._highScore=0;const t=localStorage.getItem("highScore");null!==t?this._highScore=parseInt(t):localStorage.setItem("highScore","0")}get score(){return this._score}get highScore(){return this._highScore}update(){this._score>this._highScore&&(this._highScore=this._score,localStorage.setItem("highScore",this._highScore.toString()))}increaseScore(){this._score++}resetScore(){this._score=0}},C=class{constructor(t,e,s,i){this._display=!0,this._parent=null,this._children=[],this._color="white",this._transform=new c(t,e,0,1),this._width=s,this._height=i,this._borderColor="black",this._borderWidth=1}set name(t){this._name=t}get name(){return this._name}set borderWidth(t){this._borderWidth=t}set display(t){this._display=t}get display(){return this._display}set parent(t){this._parent=t}get parent(){return this._parent}set backgroundColor(t){this._backgroundColor=t}get backgroundColor(){return this._backgroundColor}set color(t){this._color=t}get color(){return this._color}get width(){return this._width}get height(){return this._height}addChild(t){this._children.push(t),t.parent=this}removeChild(t){const e=this._children.indexOf(t);e>-1&&(this._children.splice(e,1),t.parent=null)}setPosition(t,e){this._transform.setPosition(t,e)}getPosition(){return this._transform.getPosition()}getWorldPosition(){let t=this.getPosition(),e=this._parent;for(;e;)t=t.add(e.getPosition()),e=e.parent;return t}update(t){this.animation&&this.animation.update(t),this._children.forEach((e=>e.update(t)))}updateButton(t,e){this.update(e)}render(t){if(!this._display)return;const e=this.getWorldPosition();t.fillStyle=this._backgroundColor?this._backgroundColor:"red",t.fillRect(e.x,e.y,this._width,this._height),this._borderWidth>0&&(t.strokeStyle=this._borderColor,t.lineWidth=this._borderWidth,t.strokeRect(e.x,e.y,this._width,this._height))}},k=class extends C{constructor(t,e,s,i,r,a,n,o,h=!1){super(t,e,s,i),this._isCentered=!1,this._textAlign="left",this.textAnimation=null,this.textStroke=!1,this._text=r,this._size=n,this._weight=o,this._family=a,this._isCentered=h}set textAlign(t){this._textAlign=t}setText(t){this._text=t}update(t){super.update(t),this.textAnimation&&(this.textAnimation.update(t),this._text=this.textAnimation.current.toString())}render(t){if(!this.display)return;const e=this.getWorldPosition();this.backgroundColor&&(t.fillStyle=this.backgroundColor,this._isCentered?t.fillRect(e.x-this._width/2,e.y-this._height/2,this._width,this._height):t.fillRect(e.x,e.y,this._width,this._height)),t.font=`${this._weight} ${this._size}px ${this._family}`,t.fillStyle=this.color?this.color:"white",t.lineWidth=1,this._isCentered?(t.save(),t.textBaseline="middle",t.textAlign="center",t.fillText(this._text,e.x,e.y),this.textStroke&&t.strokeText(this._text,e.x,e.y),t.restore()):(t.textAlign=this._textAlign,t.fillText(this._text,e.x,e.y),this.textStroke&&t.strokeText(this._text,e.x,e.y))}},D=class extends C{constructor(t,e,s,i,r,a,n,o,h=!1){super(t,e,s,i),this._text=new k(t+s/2,e+i/2,s,i,r,a,n,o,h)}setText(t){this._text.setText(t)}updateButton(t,e){super.updateButton(t,e),(t.isClicked()&&this.isHovered(t.mouse.x,t.mouse.y)||t.isTouchStart()&&this.isHovered(t.touch.x,t.touch.y))&&this._onClick()}render(t){if(!this.display)return;const e=this.getWorldPosition();t.fillStyle="#FFF",t.fillRect(e.x,e.y,this._width,this._height),t.strokeStyle="#000",t.lineWidth=1,t.strokeRect(e.x,e.y,this._width,this._height),t.fillStyle="#E06119",t.fillRect(e.x+5,e.y+5,this._width-10,this._height-10),this._text.render(t)}set onClick(t){this._onClick=t}get onClick(){return this._onClick}isHovered(t,e){return t>=this.getPosition().x&&t<=this.getPosition().x+this._width&&e>=this.getPosition().y&&e<=this.getPosition().y+this._height}},A=class extends C{constructor(t,e,s,i,r){super(t,e,s,i),this._image=new Image,this._image.src=r}setImage(t){this._image=t}render(t){if(!this.display)return;const e=this.getWorldPosition();t.drawImage(this._image,e.x,e.y,this._width,this._height)}},I=class{handleInput(t){const e=n.getInstance(t.canvas.canvas);return(e.isKeyDown("Space")||e.isTouchStart())&&Date.now()>this._end?new j:null}update(t,e){t.gameObjects.forEach((t=>{t.update(e)})),t.baseSpawner()}render(t){const e=r.getInstance(450,800),s=e.getContext();null!==s&&(e.clear(),e.renderBackground(),t.player.render(s),t.bases.children.forEach((t=>{t.render(s)})),this._getReadyImage.render(s))}enter(t){this._start=Date.now(),this._end=this._start+s,this._overlayAlpha=1,t.player.setRotation(0),t.player.setRotationSpeed(0),t.canvas.reset(),t.player.state=new b,this._getReadyTitle=new k(t.canvas.canvas.width/2,200,100,100,"Get Ready","Courier New",50,"bold",!0),this._getReadyImage=new A(t.canvas.canvas.width/2-138,50,276,400.5,"assets/images/message.png")}exit(t){}},O=class{handleInput(t){return n.getInstance(t.canvas.canvas).isKeyDown("Space")&&Date.now()>this._end+1e3?new I:null}update(t,e){t.gameObjects.forEach((t=>{t.update(e)})),t.baseSpawner();const s=n.getInstance(t.canvas.canvas);this._startButton.updateButton(s,e)}render(t){const e=r.getInstance(450,800),i=e.getContext();if(null===i)return;e.clear(),e.renderBackground(),t.player.render(i),t.bases.children.forEach((t=>{t.render(i)})),this._startButton.render(i),this._gameTitle.render(i);const a=Math.max(0,this._overlayAlpha-(Date.now()-this._start)/s);i.fillStyle=`rgba(0, 0, 0, ${a})`,i.fillRect(0,0,e.canvas.width,e.canvas.height)}enter(e){console.log("GameHomeState"),this._start=Date.now(),this._end=this._start+s,this._overlayAlpha=1,e.player.setRotation(0),e.player.setRotationSpeed(0),e.player.setRotationAcceleration(0),e.player.animation.play(!0),e.player.setPosition(75,300),e.scoreManager.resetScore(),e.bases.children.forEach((e=>{e.setSpeed(t)}));const i=r.getInstance(450,800);i.reset(),e.player.state=new b,e.resetObstacle(),this._startButton=new D(i.canvas.width/2-85,500,170,50,"START","Flappy Bird",20,"",!0),this._startButton.onClick=()=>{e.state=new I,e.state.enter(e)},this._gameTitle=new k(i.canvas.width/2,200,100,100,"Flappy Bird","Flappy Bird",50,"",!0),this._gameTitle.textStroke=!0}exit(t){}},B=class{render(t,e){const s=t.animation.currentFrame,i=t.getPosition();e.save(),e.translate(i.x+t.width/2,i.y+t.height/2);const r=t.getTransform().getRotation()*(Math.PI/180);e.rotate(r),e.translate(-i.x-t.width/2,-i.y-t.height/2),e.drawImage(s,i.x,i.y,68,48),e.restore()}enter(t){t.animation.stop()}exit(t){}},E=class{constructor(t,e,s,i,r,a=0){this._start=t,this._target=e,this._gameObject=s,this._duration=i,this._transformFunction=r,this._isPlaying=!1,this._time=0,this._delay=a}get isPlaying(){return this._isPlaying}play(t=0){this._isPlaying=!0,this._time=0,this._delay=t}stop(){this._isPlaying=!1}update(t){if(this._isPlaying){if(this._time+=t.delta,this._time<this._delay)return;if(this._time>=this._duration+this._delay)return this._time=this._duration,void(this._isPlaying=!1);const e=this._transformFunction((this._time-this._delay)/this._duration),s=this._start.getPosition(),i=this._target.getPosition(),r=s.x+(i.x-s.x)*e,a=s.y+(i.y-s.y)*e;this._gameObject.setPosition(r,a)}}},F=class{constructor(t,e,s,i=0){this._isPlaying=!1,this._time=0,this._duration=0,this._delay=0,this._start=t,this._target=e,this._duration=s,this._current=t,this._delay=i}get isPlaying(){return this._isPlaying}play(t=0){this._isPlaying=!0,this._time=0,this._delay=t}stop(){this._isPlaying=!1}update(t){if(this._isPlaying){if(this._time+=t.delta,this._time<this._delay)return;if(this._time>=this._duration+this._delay)return this._time=this._duration,this._isPlaying=!1,void(this._current=this._target);const e=(this._time-this._delay)/this._duration;this._current=Math.round(this._start+(this._target-this._start)*e)}}get current(){return this._current}},R=class{handleInput(t){const e=n.getInstance(t.canvas.canvas);return(e.isKeyDown("Space")||e.isTouchStart())&&Date.now()-this._start>2500?new O:null}update(t,e){t.gameObjects.forEach((t=>{t.update(e),t.updateGravity(e)})),this._gameOverTitle.update(e),this._resultDashboard.update(e);for(const e of t.bases.children)t.player.collider.checkCollision(e.collider)&&t.player.setSpeed(0);this._highScoreText.textAnimation&&!this._highScoreText.textAnimation.isPlaying&&(this._newHighScore.display=!0)}render(t){const e=t.canvas.canvas,s=e.getContext("2d");if(null===s)return;let i;t.canvas.clear(),t.canvas.renderBackground(),t.obstacles.children.forEach((t=>{t.render(s)})),t.player.render(s),t.bases.children.forEach((t=>{t.render(s)})),this._resultDashboard.render(s),this._gameOverTitle.render(s),this._finalScoreTitleText.render(s),this._finalScoreText.render(s),this._highScoreTitleText.render(s),this._highScoreText.render(s),this._newHighScore.render(s),i=Date.now()-this._start<=100?Math.min(1,(Date.now()-this._start)/200/2):Math.max(0,1-(Date.now()-this._start)/200/2),s.fillStyle=`rgba(255, 255, 255, ${i})`,s.fillRect(0,0,e.width,e.height)}enter(t){console.log("Game over"),this._start=Date.now(),this._end=this._start+200,console.log(t.player.state),t.player.state=new B,console.log(t.player.state),t.player.state.enter(t.player),this._gameOverTitle=new A(t.canvas.canvas.width/2-144,-200,288,63,"assets/images/gameover.png"),this._gameOverTitle.animation=new E(new c(t.canvas.canvas.width/2-144,-200,0,1),new c(t.canvas.canvas.width/2-144,200,0,1),this._gameOverTitle,300,(t=>Math.sin(t*Math.PI/2))),this._gameOverTitle.animation.play(400),this._resultDashboard=new C(t.canvas.canvas.width/2-60,800,120,220),this._resultDashboard.backgroundColor="rgb(219, 218, 150)",this._resultDashboard.borderWidth=3,this._finalScoreTitleText=new k(this._resultDashboard.width/2,50,100,100,"SCORE","Flappy Bird",25,"",!0),this._finalScoreTitleText.color="#E06119",this._finalScoreText=new k(this._resultDashboard.width/2,85,100,100,"0","Flappy Bird",40,"",!0),this._highScoreTitleText=new k(this._resultDashboard.width/2,this._resultDashboard.height-85,100,100,"BEST","Flappy Bird",25,"",!0),this._highScoreText=new k(this._resultDashboard.width/2,this._resultDashboard.height-50,100,100,t.scoreManager.highScore.toString(),"Flappy Bird",40,"",!0),this._finalScoreText.textStroke=!0,this._highScoreText.textStroke=!0,this._highScoreTitleText.color="#E06119",this._finalScoreTitleText.parent=this._resultDashboard,this._highScoreTitleText.parent=this._resultDashboard,this._finalScoreText.parent=this._resultDashboard,this._highScoreText.parent=this._resultDashboard,this._resultDashboard.addChild(this._finalScoreTitleText),this._resultDashboard.addChild(this._highScoreTitleText),this._resultDashboard.addChild(this._finalScoreText),this._resultDashboard.addChild(this._highScoreText),this._resultDashboard.animation=new E(new c(t.canvas.canvas.width/2-60,800,0,1),new c(t.canvas.canvas.width/2-60,300,0,1),this._resultDashboard,250,(t=>Math.sin(t*Math.PI/2))),this._finalScoreText.textAnimation=new F(0,t.scoreManager.score,500,1e3),this._newHighScore=new k(this._resultDashboard.width/2,this._resultDashboard.height-20,30,20,"NEW","Flappy Bird",10,"",!0),this._resultDashboard.addChild(this._newHighScore),this._newHighScore.parent=this._resultDashboard,this._newHighScore.backgroundColor="red",this._newHighScore.display=!1,t.scoreManager.score>t.scoreManager.highScore&&(this._highScoreText.textAnimation=new F(t.scoreManager.highScore,t.scoreManager.score,500,1e3),this._highScoreText.textAnimation.play(1900),t.scoreManager.update()),this._resultDashboard.animation.play(900),this._finalScoreText.textAnimation.play(1300),t.bases.children.forEach((t=>{t.setSpeed(0)})),t.obstacles.children.forEach((t=>{t.setSpeed(0)}))}exit(t){}},j=class{handleInput(t){const e=n.getInstance(t.canvas.canvas);return e.isKeyDown("Space")||e.isTouchStart()?(t.player.flap(),null):(t.player.unflap(),null)}update(t,e){t.canvas.update(e),t.gameObjects.forEach((t=>{t.update(e),t.updateGravity(e)})),t.baseSpawner(),t.obstacleSpawner();let s=!1;for(const e of t.obstacles.children){if(t.player.collider.checkCollision(e.children[0].collider)||t.player.collider.checkCollision(e.children[1].collider)){console.log("Obstacle Collision detected"),console.log(t.player.collider),console.log(e.children[0].collider),s=!0;break}e.children.filter((t=>t instanceof f))[0].triggerUpdate([t.player])===p.EXIT&&(t.scoreManager.increaseScore(),this._scoreText.setText(t.scoreManager.score.toString()))}for(const e of t.bases.children)if(t.player.collider.checkCollision(e.collider)){console.log("Base Collision detected");const i=t.player.getPosition();t.player.setPosition(i.x,e.getPosition().y-t.player.height),s=!0}(t.player.getPosition().y<=0||t.player.getPosition().y>=t.canvas.canvas.height)&&(s=!0),s&&(t.hitAudio.currentTime=.06,t.hitAudio.play(),t.state=new R,t.state.enter(t))}render(t){const e=t.canvas.canvas.getContext("2d");null!==e&&(t.canvas.clear(),t.canvas.renderBackground(),t.obstacles.children.forEach((t=>{t.render(e)})),t.player.render(e),t.bases.children.forEach((t=>{t.render(e)})),this._scoreText.render(e))}enter(e){e.player.flap(),e.player.setRotationAcceleration(500),this._scoreText=new k(e.canvas.canvas.width/2,200,100,100,e.scoreManager.score.toString(),"Flappy Bird",40,"",!0),this._scoreText.textStroke=!0,e.obstacles.children.forEach((e=>{e.setSpeed(t)}))}exit(t){}},M=class{handleInput(t){return null}update(t){this._loadedAssets===this._totalAssets&&(console.log("GameLoadState: Loaded all assets"),t.state=new O,t.state.enter(t))}render(t){const e=r.getInstance(450,800),s=e.getContext();null!==s&&(e.clear(),s.fillStyle="black",s.fillRect(0,0,e.canvas.width,e.canvas.height),s.fillStyle="white",s.font="30px Flappy",s.textAlign="center",s.fillText(`Loading... ${this._loadedAssets}/${this._totalAssets}`,e.canvas.width/2,e.canvas.height/2))}enter(t){console.log("GameLoadState"),this._assets=["assets/images/background-day.png","assets/images/background-night.png","assets/images/base.png","assets/images/pipe-green.png","assets/images/gameover.png","assets/images/message.png","assets/images/pipe-green-flip.png","assets/images/yellowbird-downflap.png","assets/images/yellowbird-midflap.png","assets/images/yellowbird-upflap.png","assets/audio/hit.wav","assets/audio/swoosh.wav","assets/audio/point.wav","assets/audio/wing.wav","assets/fonts/Flappy.TTF"],this._totalAssets=this._assets.length,this._loadedAssets=0;for(const e of this._assets)if(e.includes("audio")){const s=new Audio;switch(s.src=e,s.oncanplaythrough=()=>{this._loadedAssets++,console.log("Loaded audio:",e)},s.onerror=()=>{this._loadedAssets++,console.log("Failed to load audio:",e)},s.load(),e){case"assets/audio/hit.wav":t.hitAudio=s;break;case"assets/audio/point.wav":t.pointAudio=s;break;case"assets/audio/wing.wav":t.flapAudio=s,t.player.flapAudio=s}}else if(e.includes("images")){const t=new Image;t.src=e,t.onload=()=>{this._loadedAssets++,console.log("Loaded image:",e)},t.onerror=()=>{this._loadedAssets++,console.log("Failed to load image:",e)}}else if(e.includes("fonts")){const t=new FontFace("Flappy Bird",`url(${e})`);t.load().then((()=>{this._loadedAssets++,document.fonts.add(t),console.log("Loaded font:",e)})).catch((t=>{this._loadedAssets++,console.log("Failed to load font:",t)}))}}exit(t){}},W=class{constructor(t=[]){this._gameObjects=[],this._nameCount={},console.log("Scene created"),this._gameObjects=t}processInput(){}addGameObject(t){const e=t.name;console.log(e),this._nameCount[e]?(this._nameCount[e]+=1,t.name=`${e}-${this._nameCount[e]}`):this._nameCount[e]=1,this._gameObjects.push(t)}removeGameObject(t){this._gameObjects=this._gameObjects.filter((e=>e!==t))}removeGameObjectByName(t){this._gameObjects=this._gameObjects.filter((e=>e.name!==t))}get gameObjects(){return this._gameObjects}getGameObjectsNames(){return this._gameObjects.map((t=>t.name))}getGameObjectByName(t){return this._gameObjects.find((e=>e.name===t))}update(t){this._gameObjects.forEach((e=>{e.update(t)}))}render(t){this._gameObjects.forEach((e=>{e.render(t)}))}},G=class extends W{constructor(e){super(),console.log("GameScene created"),this.player=T.getInstance(),this.player.setDirection(new h(0,1)),this.player.setPosition(75,300),this.addGameObject(this.player),this.scoreManager=new P,this.bases=new m(0,0,_.STATIC_BODY,"Bases"),this.addGameObject(this.bases),this.obstacles=new m(0,0,_.STATIC_BODY,"Obstacles"),this.addGameObject(this.obstacles),this.state=new M,this.state.enter(this),this.initObstacle();for(let e=0;e<3;e++){const s=new w(450,150,_.STATIC_BODY);s.setPosition(450*e,650),this.bases.children.push(s),s.setSpeed(t),s.setDirection(new h(-1,0)),s.setParent(this.bases)}this.canvas=e}processInput(){const t=this.state.handleInput(this);null!==t&&(this.state=t,this.state.enter(this))}update(t){this.state.update(this,t)}render(){this.state.render(this)}initObstacle(){this.triggerAreas=[];for(let t=0;t<3;t++){const s=new m(0,0,_.STATIC_BODY),i=Math.floor(300*Math.random())+200;s.setPosition(900+400*t,i);const r=new x(104,640,"assets/images/pipe-green.png",_.STATIC_BODY),a=new x(104,640,"assets/images/pipe-green-flip.png",_.STATIC_BODY);r.setPosition(0,0),a.setPosition(0,-a.getHeight()-e);const n=new f(104,e,0,-200);n.audio=this.pointAudio,console.log(this.pointAudio),s.addChild(r),s.addChild(a),s.addChild(n),r.setParent(s),n.setParent(s),a.setParent(s),n.setCollider(104,e,0,-200),r.setCollider(104,640,0,0),a.setCollider(104,640,0,-a.getHeight()-e),this.obstacles.children.push(s),s.setParent(this.obstacles),s.setSpeed(0),s.setDirection(new h(-1,0))}}resetObstacle(){for(let t=0;t<this.obstacles.children.length;t++){const e=this.obstacles.children[t],s=Math.floor(300*Math.random())+200;e.setPosition(900+400*t,s),e.setSpeed(0),e.children.filter((t=>t instanceof f))[0].reset()}}obstacleSpawner(){if(this.obstacles.children[0].getPosition().x+this.obstacles.children[0].children[0].getWidth()<0){const t=this.obstacles.children.shift(),e=this.obstacles.children[this.obstacles.children.length-1],s=Math.floor(250*Math.random())+200;null==t||t.setPosition(e.getWorldPosition().x+400,s),t&&this.obstacles.children.push(t)}}baseSpawner(){if(this.bases.children[0].getPosition().x+this.bases.children[0].getWidth()<0){const e=this.bases.children.shift(),s=this.bases.children[this.bases.children.length-1];null==e||e.setPosition(s.getPosition().x+s.getWidth(),650),null==e||e.setSpeed(t),null==e||e.setDirection(new h(-1,0)),e&&this.bases.children.push(e),null==e||e.setParent(this.bases)}}};new class{constructor(){this.fps=0,this.frameCount=0,console.log("Game created"),this.canvas=r.getInstance(450,800),this._currentScene=new G(this.canvas),this._scenes=[this._currentScene],this.lastTime=window.performance.now(),requestAnimationFrame((()=>this.loop())),this.inputHandler=new n(this.canvas.canvas),this.lastFpsUpdate=window.performance.now(),this.fpsCounter=new k(10,10,100,100,"FPS: 0","Arial",10,"normal")}processInput(){this._currentScene.processInput()}update(t){this._currentScene.update(t),this.frameCount++;const e=t.time-this.lastFpsUpdate;e>1e3&&(this.fps=1e3*this.frameCount/e,this.frameCount=0,this.lastFpsUpdate=t.time,this.fpsCounter.setText(`FPS: ${Math.round(this.fps)}`))}render(){const t=this.canvas.getContext();t&&(this._currentScene.render(t),this.fpsCounter.render(t))}loop(){const t=window.performance.now(),e=t-this.lastTime;this.processInput(),this.update({time:t,delta:e}),this.render(),this.lastTime=t,requestAnimationFrame((()=>this.loop()))}}})();