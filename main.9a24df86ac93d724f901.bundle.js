(()=>{"use strict";const t=200,e=200,s="assets/images/pipe-green.png",i="assets/images/pipe-green-flip.png",r=1e3;class n{constructor(t,e){this._canvas=document.createElement("canvas"),this._canvas.width=t,this._canvas.height=e,this._canvas.style.height="100vh";const s=document.getElementById("game");if(null===s)return void alert("Unable to find game element");s.appendChild(this.canvas);const i=document.createElement("img");i.src="assets/images/background-day.png";const r=document.createElement("img");r.src="assets/images/background-night.png",this._background={day:i,night:r},this._currentBackground="day",this._restart=!0}get canvas(){return this._canvas}set canvas(t){this._canvas=t}getContext(){return this.canvas.getContext("2d")}update(t){let e;this._restart?(this._start=Date.now(),e=0,this._restart=!1):e=(Date.now()-this._start)/2e4,e>=1&&(this._start=Date.now(),this._currentBackground="day"===this._currentBackground?"night":"day",e=0),this._currentAlpha=e*e/(2*(e*e-e)+1)}reset(){this._start=Date.now(),this._currentBackground="day",this._currentAlpha=0,this._restart=!0}renderBackground(){const t=this.canvas.getContext("2d");null!==t?(t.save(),t.globalAlpha=this._currentAlpha,t.drawImage(this._background["day"===this._currentBackground?"night":"day"],0,0,this.canvas.width,this.canvas.height),t.globalAlpha=1-this._currentAlpha,t.drawImage(this._background[this._currentBackground],0,0,this.canvas.width,this.canvas.height),t.restore()):alert("Unable to get 2d context")}set currentBackground(t){this._currentBackground=t}get currentBackground(){return this._currentBackground}clear(){const t=this.canvas.getContext("2d");null!==t&&t.clearRect(0,0,this.canvas.width,this.canvas.height)}static getInstance(t,e){return n.canvas||(n.canvas=new n(t,e)),n.canvas}}const a=n;class o{constructor(t){this._keys={},this._mouse={x:0,y:0},this._touch={x:0,y:0},this._mouseClick=!1,this._touchStart=!1,this._canvas=t,window.addEventListener("keydown",(t=>{t.preventDefault()," "===t.key?this._keys.Space=!0:this._keys[t.key]=!0})),window.addEventListener("touchstart",(t=>{t.preventDefault(),this._touchStart=!0;const e=this._canvas.getBoundingClientRect(),s=this._canvas.width/e.width,i=this._canvas.height/e.height;this._touch.x=(t.touches[0].clientX-e.left)*s,this._touch.y=(t.touches[0].clientY-e.top)*i})),window.addEventListener("touchend",(t=>{t.preventDefault(),this._touchStart=!1})),window.addEventListener("keyup",(t=>{t.preventDefault()," "===t.key?this._keys.Space=!1:this._keys[t.key]=!1})),window.addEventListener("mousemove",(t=>{const e=this._canvas.getBoundingClientRect(),s=this._canvas.width/e.width,i=this._canvas.height/e.height;this._mouse.x=(t.clientX-e.left)*s,this._mouse.y=(t.clientY-e.top)*i})),window.addEventListener("click",(t=>{t.preventDefault(),this._mouseClick=!0}))}isKeyDown(t){return this._keys[t]||!1}get mouse(){return this._mouse}isClicked(){return this._mouseClick}get touch(){return this._touch}isTouchStart(){return this._touchStart}static getInstance(t){return o.instance||(o.instance=new o(t)),o.instance}}const h=o;class c{constructor(t=0,e=0){this.x=t,this.y=e}normalize(){if(0===this.magnitude())return this;const t=this.x/this.magnitude(),e=this.y/this.magnitude();return new c(t,e)}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}distanceTo(t){const e=this.x-t.x,s=this.y-t.y;return Math.sqrt(e*e+s*s)}directionTo(t){return new c(t.x-this.x,t.y-this.y)}add(t){return new c(this.x+t.x,this.y+t.y)}multiply(t){return new c(this.x*t,this.y*t)}}c.zero=new c(0,0);const l=c,d=class{constructor(t,e,s,i){this.position=new l(t,e),this.rotation=s,this.scale=i}getPosition(){return this.position}setPosition(t,e){this.position.x=t,this.position.y=e}getRotation(){return this.rotation}setRotation(t){this.rotation=t}};class u{}class g extends u{constructor(t,e){super(),this._center=t,this._radius=e}checkCollision(t){return t.checkCollisionWithCircle(this)}checkCollisionWithCircle(t){return this._center.distanceTo(t._center)<this._radius+t._radius}checkCollisionWithBox(t){const e=t.getClosestPoint(this._center);return this._center.distanceTo(e)<this._radius}getClosestPoint(t){const e=this._center.directionTo(t);return this._center.add(e.normalize().multiply(this._radius))}get center(){return this._center}get radius(){return this._radius}setPosition(t,e){this._center=new l(t,e)}}class p extends u{constructor(t,e,s,i){super(),this.width=t,this.height=e,this.transform=new d(s,i,0,1)}getClosestPoint(t){const e=Math.max(0,Math.min(t.x,this.width)),s=Math.max(0,Math.min(t.y,this.height));return new l(e,s)}checkCollision(t){return t instanceof g?this.checkCollisionWithCircle(t):t instanceof p&&this.checkCollisionWithBox(t)}checkCollisionWithCircle(t){return this.getClosestPoint(t.center).distanceTo(t.center)<t.radius}checkCollisionWithBox(t){const e=this.transform.getPosition(),s=t.transform.getPosition();return e.x<s.x+t.width&&e.x+this.width>s.x&&e.y<s.y+t.height&&e.y+this.height>s.y}setPosition(t,e){this.transform.setPosition(t,e)}}const _=class{constructor(t=0,e=l.zero){this.speed=t,this.direction=e}getSpeed(){return this.speed}getDirection(){return this.direction}setSpeed(t){this.speed=t}setDirection(t){this.direction=t}};var m,y;!function(t){t.RIGID_BODY="RIGID_BODY",t.STATIC_BODY="STATIC_BODY"}(m||(m={})),function(t){t.ENTER="ENTER",t.EXIT="EXIT",t.STAY="STAY",t.OUT="OUT"}(y||(y={}));const w=class{constructor(t,e,s,i="GameObject"){this.parent=null,this.children=[],this.display=!0,this.transform=new d(0,0,0,1),this.velocity=new _,this.width=t,this.height=e,this.collider=new p(t,e,this.transform.getPosition().x,this.transform.getPosition().y),this.bodyType=s,this._name=i}get name(){return this._name}set name(t){this._name=t}getWidth(){return this.width}getHeight(){return this.height}update(t){const e=this.transform.getPosition(),s=this.velocity.getDirection().normalize(),i=this.collider.transform.getPosition(),r=this.velocity.getSpeed();e.x+=s.x*r*t.delta/1e3,e.y+=s.y*r*t.delta/1e3;const n=this.getWorldPosition();i.x=n.x,i.y=n.y,this.children.forEach((e=>{e.update(t)}))}triggerUpdate(t){return y.OUT}updateGravity(t){this.bodyType===m.RIGID_BODY&&this.velocity.setSpeed(this.velocity.getSpeed()+2e3*t.delta/1e3)}handleCollision(t,e){const s=this.transform.getPosition(),i=(this.velocity.getSpeed(),this.velocity.getDirection().normalize(),this.collider.transform.getPosition()),r=e.transform.getPosition();(i.x>=r.x||i.x<=r.x+e.width)&&(s.x=r.x-1),(i.y>=r.y||i.y<=r.y+e.height)&&(s.y=r.y-1)}setPosition(t,e){this.transform.setPosition(t,e),this.collider.transform.setPosition(t,e)}getPosition(){return this.transform.getPosition()}getWorldPosition(){let t=this.transform.getPosition(),e=this.parent;for(;e;)t=t.add(e.getPosition()),e=e.parent;return t}setVelocity(t,e){this.velocity.setSpeed(t),this.velocity.setDirection(e)}setSpeed(t){this.velocity.setSpeed(t)}setDirection(t){this.velocity.setDirection(t)}render(t){this.display&&this.children.forEach((e=>{e.render(t)}))}setCollider(t,e,s,i){const r=this.getWorldPosition();this.collider=new p(t,e,r.x+s,r.y+i)}setRotation(t){this.transform.setRotation(t)}getTransform(){return this.transform}setParent(t){this.parent=t;const e=this.getWorldPosition();this.collider.setPosition(e.x,e.y)}addChild(t){this.children.push(t),t.setParent(this)}removeChild(t){this.children=this.children.filter((e=>e!==t))}},f=class extends w{constructor(t,e,s,i){super(t,e,m.STATIC_BODY),console.log("TriggerObject constructor"),this._transform=new d(s,i,0,1),this._width=t,this._height=e,this._objectsInArea=[],this.setPosition(s,i),this._audio=document.createElement("audio"),this._audio.src="assets/audio/point.wav"}triggerUpdate(t){for(let e=0;e<t.length;e++){if(this.collider.checkCollision(t[e].collider)&&!this._objectsInArea.includes(t[e]))return this.onTriggerEnter(t[e]),y.ENTER;if(!this.collider.checkCollision(t[e].collider)&&this._objectsInArea.includes(t[e]))return this.onTriggerExit(t[e]),y.EXIT}return y.STAY}onTriggerEnter(t){console.log("TriggerObject onTriggerEnter"),this._objectsInArea.push(t)}onTriggerExit(t){console.log("TriggerObject onTriggerExit"),this._objectsInArea=this._objectsInArea.filter((e=>e!==t)),this._audio.play()}onTriggerStay(){console.log("TriggerObject onTriggerStay")}render(t){}},S=class extends w{constructor(t,e,s){super(t,e,s,"Base"),this.sprite=document.createElement("img"),this.spriteSource="assets/images/base.png",this.sprite.src=this.spriteSource,this.width=t,this.height=e}render(t){if(!this.display)return;const e=this.transform.getPosition();t.drawImage(this.sprite,e.x,e.y,this.width,this.height)}},v=class extends w{constructor(t,e,s,i){super(t,e,i,"Obstacle"),console.log("Obstacle created"),this.sprite=document.createElement("img"),this.spriteSource=s,this.sprite.src=this.spriteSource;const r=Math.floor(300*Math.random())+100;this.setPosition(170,r)}render(t){if(!this.display)return;const e=this.getWorldPosition();super.render(t),t.drawImage(this.sprite,e.x,e.y,104,640)}},x=class{render(t,e){const s=Date.now();s-t.start>50&&(t.start=s,t.currentFrame++,t.currentFrame>t.spriteCycle.length-1&&(t.currentFrame=0));const i=t.sprite[t.spriteCycle[t.currentFrame]],r=t.getPosition();e.save(),e.translate(r.x+t.width/2,r.y+t.height/2);const n=t.getTransform().getRotation()*(Math.PI/180);e.rotate(n),e.translate(-r.x-t.width/2,-r.y-t.height/2),e.drawImage(i,r.x,r.y,68,48),e.restore()}};class b extends w{constructor(){super(68,48,m.RIGID_BODY,"Player"),this._flapped=!1,console.log("Player created"),this._sprite=[],this._spriteSource=["assets/images/yellowbird-midflap.png","assets/images/yellowbird-upflap.png","assets/images/yellowbird-downflap.png"],this._spriteSource.forEach((t=>{const e=document.createElement("img");e.src=t,this._sprite.push(e)})),this._spriteCycle=[0,1,0,2],this._frameCount=0,this._currentFrame=0,this._flapAudio=document.createElement("audio"),this._flapAudio.src="assets/audio/wing.wav",this._rotationSpeed=0,this._rotationAcceleration=0,this._start=Date.now(),this._state=new x,b.player=this}static getInstance(){return b.player||(b.player=new b,console.log("Player created")),b.player}update(t){super.update(t);let e=this.transform.getRotation()+this._rotationSpeed*t.delta/1e3;e<-30?(e=-30,this._rotationSpeed=0):e>90?e=90:(e=this.transform.getRotation()+this._rotationSpeed*t.delta/1e3,this._rotationSpeed+=this._rotationAcceleration*t.delta/1e3),this.transform.setRotation(e)}set spriteSource(t){this.spriteSource=t}render(t){this.display&&this._state.render(this,t)}flap(){this._flapped||(this._flapped=!0,this.setSpeed(-500),this.setRotation(-30),this.setRotationSpeed(0),this._flapAudio.currentTime=0,this._flapAudio.play().catch((function(t){console.log("Audio play was prevented:",t)})))}unflap(){this._flapped=!1}setRotationSpeed(t){this._rotationSpeed=t}setRotationAcceleration(t){this._rotationAcceleration=t}get start(){return this._start}set start(t){this._start=t}get currentFrame(){return this._currentFrame}set currentFrame(t){this._currentFrame=t}get spriteCycle(){return this._spriteCycle}get sprite(){return this._sprite}set state(t){this._state=t}}const C=b,T=class{constructor(){this._score=0,this._highScore=0;const t=localStorage.getItem("highScore");null!==t?this._highScore=parseInt(t):localStorage.setItem("highScore","0")}get score(){return this._score}get highScore(){return this._highScore}update(){this._score>this._highScore&&(this._highScore=this._score,localStorage.setItem("highScore",this._highScore.toString()))}increaseScore(){this._score++}resetScore(){this._score=0}},P=class{constructor(t,e){this._display=!0,this._transform=new d(t,e,0,1)}set name(t){this._name=t}get name(){return this._name}set display(t){this._display=t}get display(){return this._display}setPosition(t,e){this._transform.setPosition(t,e)}getPosition(){return this._transform.getPosition()}render(t){if(!this._display)return;const e=this._transform.getPosition();t.fillRect(e.x,e.y,150,100),t.fillStyle="red"}},I=class extends P{constructor(t,e,s,i,r,n,a=!1){super(t,e),this._isCentered=!1,this._text=s,this._size=r,this._weight=n,this._family=i,this._isCentered=a}setText(t){this._text=t}render(t){this.display&&(t.font=`${this._weight} ${this._size}px ${this._family}`,t.fillStyle="white",this._isCentered?(t.save(),t.textBaseline="middle",t.textAlign="center",t.fillText(this._text,this.getPosition().x,this.getPosition().y),t.restore()):t.fillText(this._text,this.getPosition().x,this.getPosition().y))}},k=class extends P{constructor(t,e,s,i,r,n,a,o,h=!1){super(t,e),this._text=new I(t+s/2,e+i/2,r,n,a,o,h),this._width=s,this._height=i}setText(t){this._text.setText(t)}update(t){(t.isClicked()&&this.isHovered(t.mouse.x,t.mouse.y)||t.isTouchStart()&&this.isHovered(t.touch.x,t.touch.y))&&this._onClick()}render(t){this.display&&(t.fillStyle="#E06119",t.fillRect(this.getPosition().x,this.getPosition().y,this._width,this._height),this._text.render(t))}set onClick(t){this._onClick=t}get onClick(){return this._onClick}isHovered(t,e){return t>=this.getPosition().x&&t<=this.getPosition().x+this._width&&e>=this.getPosition().y&&e<=this.getPosition().y+this._height}},O=class{handleInput(t){const e=h.getInstance(t.canvas.canvas);return(e.isKeyDown("Space")||e.isTouchStart())&&Date.now()>this._end?new B:null}update(t,e){t.gameObjects.forEach((t=>{t.update(e)})),t.baseSpawner()}render(t){const e=a.getInstance(450,800),s=e.getContext();null!==s&&(e.clear(),e.renderBackground(),t.player.render(s),t.bases.children.forEach((t=>{t.render(s)})),this._getReadyTitle.render(s))}enter(t){this._start=Date.now(),this._end=this._start+r,this._overlayAlpha=1,t.player.setRotation(0),t.player.setRotationSpeed(0),t.canvas.reset(),t.player.state=new x,this._getReadyTitle=new I(t.canvas.canvas.width/2,200,"Get Ready","Courier New",50,"bold",!0)}exit(t){}},D=class{handleInput(t){return h.getInstance(t.canvas.canvas).isKeyDown("Space")&&Date.now()>this._end?new O:null}update(t,e){t.gameObjects.forEach((t=>{t.update(e)})),t.baseSpawner();const s=h.getInstance(t.canvas.canvas);this._startButton.update(s)}render(t){const e=a.getInstance(450,800),s=e.getContext();if(null===s)return;e.clear(),e.renderBackground(),t.player.render(s),t.bases.children.forEach((t=>{t.render(s)})),this._startButton.render(s),this._gameTitle.render(s);const i=Math.max(0,this._overlayAlpha-(Date.now()-this._start)/r);s.fillStyle=`rgba(0, 0, 0, ${i})`,s.fillRect(0,0,e.canvas.width,e.canvas.height)}enter(e){this._start=Date.now(),this._end=this._start+r,this._overlayAlpha=1,e.player.setRotation(0),e.player.setRotationSpeed(0),e.player.setRotationAcceleration(0),e.bases.children.forEach((e=>{e.setSpeed(t)}));const s=a.getInstance(450,800);s.reset(),e.player.state=new x,this._startButton=new k(s.canvas.width/2-85,500,170,50,"Start","Courier New",20,"bold",!0),this._startButton.onClick=()=>{e.state=new O,e.state.enter(e)},this._gameTitle=new I(s.canvas.width/2,200,"Flappy Bird","Courier New",50,"bold",!0)}exit(t){}},A=class{render(t,e){const s=t.sprite[t.spriteCycle[t.currentFrame]],i=t.getPosition();e.save(),e.translate(i.x+t.width/2,i.y+t.height/2);const r=t.getTransform().getRotation()*(Math.PI/180);e.rotate(r),e.translate(-i.x-t.width/2,-i.y-t.height/2),e.drawImage(s,i.x,i.y,68,48),e.restore()}},E=class{handleInput(t){const e=h.getInstance(t.canvas.canvas);return(e.isKeyDown("Space")||e.isTouchStart())&&Date.now()-this._start>1e3?(t.player.setPosition(75,300),t.initObstacle(),t.scoreManager.resetScore(),new D):null}update(t,e){t.gameObjects.forEach((t=>{t.update(e),t.updateGravity(e)}));for(const e of t.bases.children)t.player.collider.checkCollision(e.collider)&&t.player.setSpeed(0)}render(t){const e=t.canvas.canvas,s=e.getContext("2d");if(null===s)return;let i;t.canvas.clear(),t.canvas.renderBackground(),t.obstacles.children.forEach((t=>{t.render(s)})),t.player.render(s),t.bases.children.forEach((t=>{t.render(s)})),this._gameOverTitle.render(s),this._finalScoreText.setText("Score: "+t.scoreManager.score.toString()),this._highScoreText.setText("High score: "+t.scoreManager.highScore.toString()),this._finalScoreText.render(s),this._highScoreText.render(s),i=Date.now()-this._start<=100?Math.min(1,(Date.now()-this._start)/200/2):Math.max(0,1-(Date.now()-this._start)/200/2),s.fillStyle=`rgba(255, 255, 255, ${i})`,s.fillRect(0,0,e.width,e.height)}enter(t){console.log("Game over"),this._start=Date.now(),this._end=this._start+200,t.player.state=new A,this._gameOverTitle=new I(t.canvas.canvas.width/2,200,"Game Over","Courier New",50,"bold",!0),this._finalScoreText=new I(t.canvas.canvas.width/2,300,"Final Score: "+t.scoreManager.score.toString(),"Courier New",40,"bold",!0),this._highScoreText=new I(t.canvas.canvas.width/2,350,"High Score: "+t.scoreManager.highScore.toString(),"Courier New",20,"bold",!0),t.bases.children.forEach((t=>{t.setSpeed(0)})),t.obstacles.children.forEach((t=>{t.setSpeed(0)}))}exit(t){}},B=class{handleInput(t){const e=h.getInstance(t.canvas.canvas);return e.isKeyDown("Space")||e.isTouchStart()?(t.player.flap(),null):(t.player.unflap(),null)}update(t,e){t.canvas.update(e),t.gameObjects.forEach((t=>{t.update(e),t.updateGravity(e)})),t.baseSpawner(),t.obstacleSpawner();let s=!1;for(const e of t.obstacles.children){if(t.player.collider.checkCollision(e.children[0].collider)||t.player.collider.checkCollision(e.children[1].collider)){console.log("Obstacle Collision detected"),console.log(t.player.collider),console.log(e.children[0].collider),s=!0;break}e.children.filter((t=>t instanceof f))[0].triggerUpdate([t.player])===y.EXIT&&(t.scoreManager.increaseScore(),t.scoreManager.update(),this._scoreText.setText(t.scoreManager.score.toString()))}for(const e of t.bases.children)t.player.collider.checkCollision(e.collider)&&(console.log("Base Collision detected"),s=!0);(t.player.getPosition().y<=0||t.player.getPosition().y>=t.canvas.canvas.height)&&(s=!0),s&&(t.hitAudio.currentTime=.06,t.hitAudio.play(),t.state=new E,t.state.enter(t))}render(t){const e=t.canvas.canvas.getContext("2d");null!==e&&(t.canvas.clear(),t.canvas.renderBackground(),t.obstacles.children.forEach((t=>{t.render(e)})),t.player.render(e),t.bases.children.forEach((t=>{t.render(e)})),this._scoreText.render(e))}enter(t){t.player.flap(),t.player.setRotationAcceleration(500),t.initObstacle(),this._scoreText=new I(t.canvas.canvas.width/2,200,t.scoreManager.score.toString(),"Courier New",40,"bold",!0)}exit(t){}},j=class{constructor(t=[]){this._gameObjects=[],this._nameCount={},console.log("Scene created"),this._gameObjects=t}processInput(){}addGameObject(t){const e=t.name;console.log(e),this._nameCount[e]?(this._nameCount[e]+=1,t.name=`${e}-${this._nameCount[e]}`):this._nameCount[e]=1,this._gameObjects.push(t)}removeGameObject(t){this._gameObjects=this._gameObjects.filter((e=>e!==t))}removeGameObjectByName(t){this._gameObjects=this._gameObjects.filter((e=>e.name!==t))}get gameObjects(){return this._gameObjects}getGameObjectsNames(){return this._gameObjects.map((t=>t.name))}getGameObjectByName(t){return this._gameObjects.find((e=>e.name===t))}update(t){this._gameObjects.forEach((e=>{e.update(t)}))}render(t){this._gameObjects.forEach((e=>{e.render(t)}))}},R=class extends j{constructor(e){super(),console.log("GameScene created"),this.player=C.getInstance(),this.player.setDirection(new l(0,1)),this.player.setPosition(75,300),this.addGameObject(this.player),this.scoreManager=new T,this.bases=new w(0,0,m.STATIC_BODY,"Bases"),this.addGameObject(this.bases),this.state=new D,this.state.enter(this);for(let e=0;e<3;e++){const s=new S(450,150,m.STATIC_BODY);s.setPosition(450*e,650),this.bases.children.push(s),s.setSpeed(t),s.setDirection(new l(-1,0)),s.setParent(this.bases)}this.hitAudio=document.createElement("audio"),this.hitAudio.src="assets/audio/hit.wav",this.canvas=e}processInput(){const t=this.state.handleInput(this);null!==t&&(this.state=t,this.state.enter(this))}update(t){this.state.update(this,t)}render(){this.state.render(this)}initObstacle(){this.obstacles=new w(0,0,m.STATIC_BODY,"Obstacles"),this.addGameObject(this.obstacles),this.triggerAreas=[];for(let r=0;r<3;r++){const n=new w(0,0,m.STATIC_BODY),a=Math.floor(300*Math.random())+200;n.setPosition(900+350*r,a);const o=new v(104,640,s,m.STATIC_BODY),h=new v(104,640,i,m.STATIC_BODY);o.setPosition(0,0),h.setPosition(0,-h.getHeight()-e);const c=new f(104,e,0,-200);n.addChild(o),n.addChild(h),n.addChild(c),o.setParent(n),c.setParent(n),h.setParent(n),c.setCollider(104,e,0,-200),o.setCollider(104,640,0,0),h.setCollider(104,640,0,-h.getHeight()-e),this.obstacles.children.push(n),n.setParent(this.obstacles),n.setSpeed(t),n.setDirection(new l(-1,0))}}obstacleSpawner(){if(this.obstacles.children[0].getPosition().x+this.obstacles.children[0].children[0].getWidth()<0){this.obstacles.children.shift(),this.triggerAreas.shift();const r=new w(0,0,m.STATIC_BODY),n=new v(104,640,s,m.STATIC_BODY),a=new v(104,640,i,m.STATIC_BODY),o=this.obstacles.children[this.obstacles.children.length-1],h=Math.floor(250*Math.random())+200;r.setPosition(o.getWorldPosition().x+350,h),n.setPosition(0,0),a.setPosition(0,-a.getHeight()-e);const c=new f(104,e,0,-200);r.addChild(n),r.addChild(a),r.addChild(c),n.setParent(r),a.setParent(r),c.setParent(r),r.setSpeed(t),r.setDirection(new l(-1,0)),this.obstacles.children.push(r),this.triggerAreas.push(c)}}baseSpawner(){if(this.bases.children[0].getPosition().x+this.bases.children[0].getWidth()<0){this.bases.children.shift();const e=new S(450,150,m.STATIC_BODY),s=this.bases.children[this.bases.children.length-1];e.setPosition(s.getPosition().x+s.getWidth(),650),e.setSpeed(t),e.setDirection(new l(-1,0)),this.bases.children.push(e),e.setParent(this.bases)}}};new class{constructor(){this.fps=0,this.frameCount=0,console.log("Game created"),this.canvas=a.getInstance(450,800),this._currentScene=new R(this.canvas),this._scenes=[this._currentScene],this.lastTime=window.performance.now(),requestAnimationFrame((()=>this.loop())),this.inputHandler=new h(this.canvas.canvas),this.lastFpsUpdate=window.performance.now(),this.fpsCounter=new I(10,10,"FPS: 0","Arial",10,"normal")}processInput(){this._currentScene.processInput()}update(t){this._currentScene.update(t),this.frameCount++;const e=t.time-this.lastFpsUpdate;e>1e3&&(this.fps=1e3*this.frameCount/e,this.frameCount=0,this.lastFpsUpdate=t.time,this.fpsCounter.setText(`FPS: ${Math.round(this.fps)}`))}render(){const t=this.canvas.getContext();t&&(this._currentScene.render(t),this.fpsCounter.render(t))}loop(){const t=window.performance.now(),e=t-this.lastTime;this.processInput(),this.update({time:t,delta:e}),this.render(),this.lastTime=t,requestAnimationFrame((()=>this.loop()))}}})();